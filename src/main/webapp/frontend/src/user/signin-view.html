<!--

    Copyright (c) 2018 Institut de recherches cliniques de Montreal (IRCM)

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU Affero General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU Affero General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.

-->

<!--
    A lot of code was copied from Vaadin's starter project and is submitted to Commercial Vaadin
    Add-On License version 3.
-->
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/vaadin-ordered-layout/src/vaadin-vertical-layout.html">
<link rel="import" href="../../bower_components/iron-form/iron-form.html">
<link rel="import" href="../../bower_components/vaadin-text-field/src/vaadin-text-field.html">
<link rel="import" href="../../bower_components/vaadin-text-field/src/vaadin-password-field.html">
<link rel="import" href="../../bower_components/vaadin-button/src/vaadin-button.html">

<link rel="import" href="../../styles/shared-styles.html">

<dom-module id="signin-view">
    <template>
<style include="shared-styles">
            :host {
                display: block;
            }
        </style>
<vaadin-vertical-layout style="width: 100%; height: 100%;" theme="padding">
 <h2 id="h2">Sign in</h2>
 <iron-form id="form" allow-redirect>
  <form method="post" action="signin">
   <vaadin-vertical-layout theme="spacing">
    <vaadin-text-field id="username" label="Username" autofocus="true" required="true" name="username"></vaadin-text-field>
    <vaadin-password-field id="password" label="Password" required="true" name="password" on-keydown="_onPasswordKeydown"></vaadin-password-field>
    <vaadin-button id="signin" theme="primary" on-tap="dosignin">
      Sign In 
    </vaadin-button>
    <template is="dom-if" if="[[error]]">
      <div class="error">
        <iron-icon icon="vaadin:exclamation-circle-o" class="error__icon"></iron-icon>
        <p class="error__text">
          The username and password you entered do not match our records. Please double-check and try again.
        </p>
      </div>
    </template>
   </vaadin-vertical-layout>
  </form>
 </iron-form>
</vaadin-vertical-layout>
</template>
    <script>
        class SigninView extends Polymer.Element {
            static get is() {
                return 'signin-view';
            }
            static get properties() {
                return {
                  error: {
                    type: Boolean,
                    value: false
                  }
                };
            }
            dosignin() {
              if (!this.$.username.invalid && !this.$.password.invalid) {
                this.$.form.submit();
              }
            }
            _onPasswordKeydown(event) {
              if (event.key === 'Enter' || event.keyCode == 13) {
                this.dosignin();
              }
            }
        }
        customElements.define(SigninView.is, SigninView);
    </script>
</dom-module>